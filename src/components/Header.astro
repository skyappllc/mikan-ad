---
import type { NavItem } from '../data/site';

interface Props {
  navItems: NavItem[];
  currentPath: string;
}

const { navItems, currentPath } = Astro.props;
const isActive = (href: string) => (href === '/' ? currentPath === '/' : currentPath.startsWith(href));
---

<header class="site-header" data-site-header>
  <div class="container header-inner">
    <a href="/" class="brand" aria-label="株式会社みかん トップへ">
      <span class="brand-mark" aria-hidden="true">MIKAN</span>
      <span class="brand-name">株式会社みかん</span>
    </a>

    <button
      class="menu-toggle"
      type="button"
      data-menu-toggle
      aria-expanded="false"
      aria-controls="mobile-nav"
      aria-label="メニューを開く"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="desktop-nav" aria-label="メインナビゲーション">
      <ul role="list">
        {
          navItems.map((item) => (
            <li>
              <a href={item.href} class={isActive(item.href) ? 'active' : ''} aria-current={isActive(item.href) ? 'page' : undefined}>
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>

  <nav class="mobile-nav" id="mobile-nav" data-mobile-nav hidden aria-label="モバイルナビゲーション">
    <ul role="list">
      {
        navItems.map((item) => (
          <li>
            <a href={item.href} class={isActive(item.href) ? 'active' : ''} aria-current={isActive(item.href) ? 'page' : undefined}>
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>

<script>
  const header = document.querySelector('[data-site-header]');
  const menuToggle = document.querySelector('[data-menu-toggle]');
  const mobileNav = document.querySelector('[data-mobile-nav]');

  const onScroll = () => {
    if (!header) {
      return;
    }

    header.classList.toggle('scrolled', window.scrollY > 24);
  };

  onScroll();
  window.addEventListener('scroll', onScroll, { passive: true });

  if (menuToggle instanceof HTMLButtonElement && mobileNav instanceof HTMLElement) {
    const setMenuState = (open) => {
      menuToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
      menuToggle.setAttribute('aria-label', open ? 'メニューを閉じる' : 'メニューを開く');
      menuToggle.classList.toggle('open', open);
      mobileNav.hidden = !open;
    };

    menuToggle.addEventListener('click', () => {
      const expanded = menuToggle.getAttribute('aria-expanded') === 'true';
      setMenuState(!expanded);
    });

    mobileNav.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => setMenuState(false));
    });
  }
</script>
